!function(e){for(var t={initial:"* * * * *",minuteOpts:{minWidth:100,itemWidth:30,columns:4,rows:void 0,title:"Minutes past the hour"},timeHourOpts:{minWidth:100,itemWidth:20,columns:2,rows:void 0,title:"Hour"},domOpts:{minWidth:100,itemWidth:30,columns:void 0,rows:10,title:"Day of the Month"},monthOpts:{minWidth:100,itemWidth:100,columns:2,rows:void 0,title:void 0},dowOpts:{minWidth:100,itemWidth:void 0,columns:void 0,rows:void 0,title:void 0},timeMinuteOpts:{minWidth:100,itemWidth:20,columns:4,rows:void 0,title:"Minute"},effectOpts:{openSpeed:400,closeSpeed:400,openEffect:"slide",closeEffect:"slide",hideOnMouseOut:!0},url_set:void 0,customValues:void 0,onChange:void 0,useGentleSelect:!1},n="",i=0;i<60;i++){var a=i<10?"0":"";n+="<option value='"+i+"'>"+a+i+"</option>\n"}for(var s="",i=0;i<24;i++){var a=i<10?"0":"";s+="<option value='"+i+"'>"+a+i+"</option>\n"}for(var r="",i=1;i<32;i++){if(1==i||21==i||31==i)var l="";else if(2==i||22==i)var l="";else if(3==i||23==i)var l="";else var l="";r+="<option value='"+i+"'>"+i+l+"</option>\n"}for(var c="",d=["January","February","March","April","May","June","July","August","September","October","November","December"],i=0;i<d.length;i++)c+="<option value='"+(i+1)+"'>"+d[i]+"</option>\n";for(var u="",m=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],i=0;i<m.length;i++)u+="<option value='"+i+"'>"+m[i]+"</option>\n";for(var p="",h=["minute","hour","day","week","month","year"],i=0;i<h.length;i++)p+="<option value='"+h[i]+"'>"+h[i]+"</option>\n";var v={minute:[],hour:["mins"],day:["time"],week:["dow","time"],month:["dom","time"],year:["dom","month","time"]},f={minute:/^(\*\s){4}\*$/,hour:/^\d{1,2}\s(\*\s){3}\*$/,day:/^(\d{1,2}\s){2}(\*\s){2}\*$/,week:/^(\d{1,2}\s){2}(\*\s){2}\d{1,2}$/,month:/^(\d{1,2}\s){3}\*\s\*$/,year:/^(\d{1,2}\s){4}\*$/};function $(e){return void 0!==e}function b(t,n){if($(n.customValues)){for(key in n.customValues)if(t==n.customValues[key])return key}if("string"!=typeof t||!/^((\d{1,2}|\*)\s){4}(\d{1,2}|\*)$/.test(t)){e.error("cron: invalid initial value");return}for(var i=t.split(" "),a=[0,0,1,1,0],s=[59,23,31,12,6],r=0;r<i.length;r++)if("*"!=i[r]){var l=parseInt(i[r]);if(!$(l)||!(l<=s[r])||!(l>=a[r])){e.error("cron: invalid value found (col "+(r+1)+") in "+o.initial);return}}for(var c in f)if(f[c].test(t))return c;e.error("cron: valid but unsupported cron format. sorry.")}var O={init:function(i){var a=i||{},l=e.extend([],t,a),d=e.extend({},t.effectOpts,a.effectOpts);if(e.extend(l,{minuteOpts:e.extend({},t.minuteOpts,d,a.minuteOpts),domOpts:e.extend({},t.domOpts,d,a.domOpts),monthOpts:e.extend({},t.monthOpts,d,a.monthOpts),dowOpts:e.extend({},t.dowOpts,d,a.dowOpts),timeHourOpts:e.extend({},t.timeHourOpts,d,a.timeHourOpts),timeMinuteOpts:e.extend({},t.timeMinuteOpts,d,a.timeMinuteOpts)}),function t(n,i){var a;if(!$(b(i.initial,i))||$(a=i.customValues)&&"object"!=typeof a)return!0;if($(i.customValues)){for(key in i.customValues)if(f.hasOwnProperty(key))return e.error("cron: reserved keyword '"+key+"' should not be used as customValues key."),!0}return!1}(this,l))return this;var m=[],h="",v=l.customValues;if($(v))for(var y in v)h+="<option value='"+v[y]+"'>"+y+"</option>\n";m.period=e("<span class='cron-period'>Each <select name='cron-period'>"+h+p+"</select> </span>").appendTo(this).data("root",this);var k=m.period.find("select");return k.bind("change.cron",g.periodChanged).data("root",this),l.useGentleSelect&&k.gentleSelect(d),m.dom=e("<span class='cron-block cron-block-dom'> the <select name='cron-dom'>"+r+"</select> </span>").appendTo(this).data("root",this),k=m.dom.find("select").data("root",this),l.useGentleSelect&&k.gentleSelect(l.domOpts),m.month=e("<span class='cron-block cron-block-month'> of <select name='cron-month'>"+c+"</select> </span>").appendTo(this).data("root",this),k=m.month.find("select").data("root",this),l.useGentleSelect&&k.gentleSelect(l.monthOpts),m.mins=e("<span class='cron-block cron-block-mins'> <select name='cron-mins'>"+n+"</select> minuti dopo lo scoccare dell'ora </span>").appendTo(this).data("root",this),k=m.mins.find("select").data("root",this),l.useGentleSelect&&k.gentleSelect(l.minuteOpts),m.dow=e("<span class='cron-block cron-block-dow'> di <select name='cron-dow'>"+u+"</select> </span>").appendTo(this).data("root",this),k=m.dow.find("select").data("root",this),l.useGentleSelect&&k.gentleSelect(l.dowOpts),m.time=e("<span class='cron-block cron-block-time'> to <select name='cron-time-hour' class='cron-time-hour'>"+s+"</select>:<select name='cron-time-min' class='cron-time-min'>"+n+" </span>").appendTo(this).data("root",this),k=m.time.find("select.cron-time-hour").data("root",this),l.useGentleSelect&&k.gentleSelect(l.timeHourOpts),k=m.time.find("select.cron-time-min").data("root",this),l.useGentleSelect&&k.gentleSelect(l.timeMinuteOpts),m.controls=e("<span class='cron-controls'>&laquo; save <span class='cron-button cron-button-save'></span> </span>").appendTo(this).data("root",this).find("span.cron-button-save").bind("click.cron",g.saveClicked).data("root",this).end(),this.find("select").bind("change.cron-callback",g.somethingChanged),this.data("options",l).data("block",m),this.data("current_value",l.initial),O.value.call(this,l.initial)},value:function(e){if(!e)return function e(t){var n=t.data("block"),i=hour=day=month=dow="*",a=n.period.find("select").val();switch(a){case"minute":break;case"hour":i=n.mins.find("select").val();break;case"day":i=n.time.find("select.cron-time-min").val(),hour=n.time.find("select.cron-time-hour").val();break;case"week":i=n.time.find("select.cron-time-min").val(),hour=n.time.find("select.cron-time-hour").val(),dow=n.dow.find("select").val();break;case"month":i=n.time.find("select.cron-time-min").val(),hour=n.time.find("select.cron-time-hour").val(),day=n.dom.find("select").val();break;case"year":i=n.time.find("select.cron-time-min").val(),hour=n.time.find("select.cron-time-hour").val(),day=n.dom.find("select").val(),month=n.month.find("select").val();break;default:return a}return[i,hour,day,month,dow].join(" ")}(this);var t=this.data("options"),n=this.data("block"),i=t.useGentleSelect,a=b(e,t);if(!$(a))return!1;if($(t.customValues)&&t.customValues.hasOwnProperty(a))a=t.customValues[a];else for(var s=e.split(" "),r={mins:s[0],hour:s[1],dom:s[2],month:s[3],dow:s[4]},l=v[a],c=0;c<l.length;c++){var d=l[c];if("time"==d){var u=n[d].find("select.cron-time-hour").val(r.hour);i&&u.gentleSelect("update"),u=n[d].find("select.cron-time-min").val(r.mins),i&&u.gentleSelect("update")}else{var u=n[d].find("select").val(r[d]);i&&u.gentleSelect("update")}}var m=n.period.find("select").val(a);return i&&m.gentleSelect("update"),m.trigger("change"),this}},g={periodChanged:function(){var t=e(this).data("root"),n=t.data("block");t.data("options");var i=e(this).val();if(t.find("span.cron-block").hide(),v.hasOwnProperty(i))for(var a=v[e(this).val()],s=0;s<a.length;s++)n[a[s]].show()},somethingChanged:function(){root=e(this).data("root"),$(root.data("options").url_set)?O.value.call(root)!=root.data("current_value")?(root.addClass("cron-changed"),root.data("block").controls.fadeIn()):(root.removeClass("cron-changed"),root.data("block").controls.fadeOut()):root.data("block").controls.hide();var t=root.data("options").onChange;$(t)&&e.isFunction(t)&&t.call(root)},saveClicked:function(){var t=e(this),n=t.data("root"),i=O.value.call(n);!t.hasClass("cron-loading")&&(t.addClass("cron-loading"),e.ajax({type:"POST",url:n.data("options").url_set,data:{cron:i},success:function(){n.data("current_value",i),t.removeClass("cron-loading"),i==O.value.call(n)&&(n.removeClass("cron-changed"),n.data("block").controls.fadeOut())},error:function(){alert("An error occured when submitting your request. Try again?"),t.removeClass("cron-loading")}}))}};e.fn.cron=function(t){return O[t]?O[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.cron"):O.init.apply(this,arguments)}}(jQuery);
